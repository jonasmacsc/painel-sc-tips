<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SC Tips ‚Ä¢ Painel (1 arquivo)</title>
<style>
:root{--bg:#0b1220;--card:#121a29;--stroke:#2b3a55;--muted:#9aa4b2;--text:#eef3ff}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,Segoe UI,Roboto,Arial,sans-serif}
.topbar{position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid var(--stroke);background:linear-gradient(180deg,#0f1726,#0c1422)}
.badge{background:#1d2a3f;border:1px solid var(--stroke);padding:4px 8px;border-radius:999px;font-size:12px;color:#b8c4d6}
a.ghost,button.ghost{background:transparent;color:#d6def0;border:1px solid var(--stroke);padding:8px 12px;border-radius:10px;cursor:pointer;text-decoration:none}
.wrap{display:grid;grid-template-columns:320px 1fr;gap:14px;padding:14px;max-width:1400px;margin:0 auto}
.sidebar{display:flex;flex-direction:column;gap:14px}
.card{background:linear-gradient(180deg,#101826,#0f1828);border:1px solid var(--stroke);border-radius:16px;padding:14px;box-shadow:0 8px 26px rgba(0,0,0,.25)}
.card h3{margin:0 0 10px;font-size:16px}.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.muted{color:var(--muted)}.tiny{font-size:12px}
input[type=text]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--stroke);background:#0f1726;color:#e8eefc}
button,.btn-primary{padding:10px 14px;border-radius:12px;border:1px solid var(--stroke);background:#121a29;color:#e8eefc;cursor:pointer}
.btn-primary{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.2) inset}
.pill{display:flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--stroke);border-radius:999px;width:fit-content;color:#c7d2e5}
.content{display:flex;flex-direction:column;gap:14px}
.big-number{font-size:56px;font-weight:800;letter-spacing:1px;padding:6px 0}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
.strategy{border:1px solid var(--stroke);border-radius:14px;padding:10px;background:linear-gradient(180deg,#0e1524,#0b1320)}
.strategy .title{font-weight:700}.strategy .nums{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px}
.strategy .num{padding:6px 10px;border-radius:999px;border:1px solid #33415c;background:#0f1726}
.log-box{border:1px solid var(--stroke);border-radius:12px;background:#0e1524;min-height:200px;max-height:340px;overflow:auto;padding:8px}
.log-entry{display:flex;gap:8px;padding:6px 8px;border-bottom:1px dashed #243149;align-items:baseline}
.log-entry .time{color:#7f8aa3;font-size:12px;min-width:92px}.log-entry .msg{white-space:pre-wrap;word-break:break-word}
.timer{display:flex;flex-direction:column;gap:8px}#timerValue{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:38px}
.tools-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
.tool{border:1px solid var(--stroke);border-radius:14px;padding:10px;background:linear-gradient(180deg,#0e1524,#0b1320)}
.tool .title{font-weight:700;margin-bottom:8px}
.counter{display:flex;flex-direction:column;align-items:center;padding:8px 12px;border:1px dashed var(--stroke);border-radius:12px}
.counter-val{font-size:28px;font-weight:800}
</style>
</head>
<body>
  <header class="topbar">
    <div class="left"><strong>SC Tips ‚Ä¢ Painel</strong> <span class="badge">Beta</span></div>
    <div class="right"><button id="btnToggleTheme" class="ghost">üåì Tema</button></div>
  </header>

  <div class="wrap">
    <aside class="sidebar">
      <section class="card">
        <h3>üîå Conex√£o WS</h3>
        <label class="muted">Cole a URL WebSocket (Evolution/Pragmatic):</label>
        <input id="wsUrl" type="text" placeholder="wss://.../socket?messageFormat=json&..." />
        <div class="row">
          <button id="btnConnect" class="btn-primary">Conectar</button>
          <button id="btnDisconnect">Desconectar</button>
        </div>
        <label class="pill"><input type="checkbox" id="saveUrl" checked> Salvar no navegador</label>
        <div class="muted tiny">Evolution (<code>type: "roulette.winSpots"</code>) e Pragmatic (<code>winningNumber</code>).</div>
      </section>

      <section class="card">
        <h3>‚è±Ô∏è Timer 18s</h3>
        <div class="timer">
          <div id="timerValue">18.0</div>
          <div class="row">
            <button id="btnTimerStart" class="btn-primary">Start</button>
            <button id="btnTimerStop">Stop</button>
            <button id="btnTimerReset">Reset</button>
          </div>
          <label class="pill"><input type="checkbox" id="beepOnTick" checked> Beep (WebAudio)</label>
          <label class="pill"><input type="checkbox" id="useWavOnTimer"> Usar WAV no Timer</label>
        </div>
      </section>

      <section class="card">
        <h3>üì¶ Exportar</h3>
        <button id="btnExportCSV" class="btn-primary">üìÑ Logs (.csv)</button>
        <button id="btnClearLogs">üßπ Limpar</button>
      </section>
    </aside>

    <main class="content">
      <section class="card">
        <h3>üì° Eventos da Roleta</h3>
        <div id="lastNumber" class="big-number">--</div>
        <div class="muted">Mesa: <span id="tableName">--</span> ‚Ä¢ Dealer: <span id="dealerName">--</span> ‚Ä¢ Plataforma: <span id="platformName">--</span></div>
      </section>

      <section class="card">
        <h3>üßÆ Estrat√©gias ‚Äì N√∫meros Base (sem vizinhos)</h3>
        <div class="grid" id="strategies"></div>
        <div class="muted tiny">Edite no ‚Äú‚ãØ‚Äù ou via <code>localStorage.sc_strategies</code>.</div>
      </section>

      <section class="card">
        <h3>üß∞ Ferramentas do Painel</h3>
        <div class="tools-grid">
          <div class="tool">
            <div class="title">üéµ Sons (teste)</div>
            <div class="row">
              <button class="btn-primary" data-sound="green">Tocar Green</button>
              <button data-sound="red">Tocar Red</button>
              <button data-sound="alerta">Tocar Alerta</button>
              <button data-sound="click">Tocar Click</button>
            </div>
            <div class="tiny muted">Em 1 arquivo, os sons s√£o opcionais. Sem arquivos .wav, use o Beep.</div>
          </div>
          <div class="tool">
            <div class="title">üìà Contadores</div>
            <div class="row" style="gap:12px">
              <div class="counter"><div id="cntGreen" class="counter-val">0</div><div class="tiny muted">Greens</div></div>
              <div class="counter"><div id="cntRed" class="counter-val">0</div><div class="tiny muted">Reds</div></div>
            </div>
            <div class="row">
              <button id="btnIncGreen" class="btn-primary">+ Green</button>
              <button id="btnIncRed">+ Red</button>
              <button id="btnResetCounters">Reset</button>
            </div>
          </div>
          <div class="tool">
            <div class="title">üóÇÔ∏è Estrat√©gias (JSON)</div>
            <div class="row">
              <button id="btnExportStrats" class="btn-primary">Exportar JSON</button>
              <label class="pill">Importar JSON <input type="file" id="fileImportStrats" accept="application/json"></label>
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <h3>üõ∞Ô∏è Logs</h3>
        <input id="logFilter" type="text" placeholder="Filtrar (pragmatic, evolution, n√∫mero 29, dealer...)">
        <div id="logBox" class="log-box"></div>
      </section>
    </main>
  </div>

<script>
(function(){
  const $=id=>document.getElementById(id), qsa=(s,c=document)=>Array.from(c.querySelectorAll(s));
  const logBox=$("logBox"), wsUrlInput=$("wsUrl"), saveUrlChk=$("saveUrl");
  const lastNumber=$("lastNumber"), tableName=$("tableName"), dealerName=$("dealerName"), platformName=$("platformName");
  const filterInput=$("logFilter"); let ws=null, timerInterval=null, timerVal=18.0, useWavOnTimer=false;

  // Sons (opcionais). Em arquivo √∫nico, v√£o falhar silenciosamente se n√£o existirem.
  const sounds={ green:new Audio("green.wav"), red:new Audio("red.wav"), alerta:new Audio("alerta.wav"), click:new Audio("click.wav") };
  Object.values(sounds).forEach(a=>{ try{a.preload="auto";a.volume=0.9;}catch{} });

  wsUrlInput.value=localStorage.getItem("sc_ws_url")||"";

  const defaultStrategies=[
    {name:"Elite 2X",trigger:"Terminal 4/5",base:[2,12,22,32],note:"Prote√ß√£o: 0 | 2 vizinhos (n√£o exibidos)"},
    {name:"Quarta Dimens√£o",trigger:"Terminal 1/3",base:[4,14,24,34],note:"Base sem vizinhos"},
    {name:"F√≥rmula 5X",trigger:"Terminal 6/8",base:[5,15,25,35],note:"Base sem vizinhos"},
    {name:"Alpha 6",trigger:"Terminal 2/9",base:[6,16,26,36],note:"Base sem vizinhos"},
    {name:"Padr√£o Black",trigger:"13/31/33",base:[13,31,33],note:"Pretos-chave"},
    {name:"Zero Shield",trigger:"Repeti√ß√£o do 0",base:[0],note:"Cobertura 0"},
    {name:"Fire Precision SC",trigger:"Sequ√™ncia alta",base:[19,20,21,22],note:"Sem vizinhos"},
    {name:"Vizinhos do Zero SC",trigger:"0 recente",base:[26,32,15,0,3],note:"Exibindo apenas base"},
    {name:"D√∫zia Estrat√©gica SC",trigger:"D√∫zia 2 fraca",base:[13,14,15,16,17,18],note:"Foco d√∫zia 2"},
    {name:"Coluna de Ouro SC",trigger:"Coluna 1 fria",base:[1,4,7,10,13,16,19,22,25,28,31,34],note:"Coluna 1"},
    {name:"Alvo Inteligente SC",trigger:"Rebote impar",base:[1,3,5,7,9],note:"Curto alcance"},
    {name:"Terminais 7",trigger:"Terminal 7",base:[7,17,27],note:"Sem vizinhos"},
    {name:"Terminais 9",trigger:"Terminal 9",base:[9,19,29],note:"Sem vizinhos"},
    {name:"Paridade Forte",trigger:"3 √≠mpares seguidos",base:[2,4,6,8,10],note:"Paridade"},
    {name:"Setor Alto",trigger:"Alta 19‚Äì36",base:[19,21,23,27,30,32,35],note:"Alta"},
    {name:"Setor Baixo",trigger:"Baixa 1‚Äì18",base:[1,2,3,6,8,12,14,16],note:"Baixa"}
  ];
  let strategies=JSON.parse(localStorage.getItem("sc_strategies")||"null")||defaultStrategies;
  renderStrategies();

  function renderStrategies(){
    const box=document.getElementById("strategies"); box.innerHTML="";
    strategies.forEach((s,idx)=>{
      const card=document.createElement("div"); card.className="strategy";
      card.innerHTML=`
        <div class="row" style="justify-content:space-between;align-items:center;">
          <div class="title">${s.name}</div>
          <div class="row">
            <button class="ghost" title="Duplicar" data-dup="${idx}">‚ßâ</button>
            <button class="ghost" title="Editar" data-idx="${idx}">‚ãØ</button>
            <button class="ghost" title="Excluir" data-del="${idx}">‚úñ</button>
          </div>
        </div>
        <div class="muted">Gatilho: ${s.trigger}</div>
        <div class="nums">${s.base.map(n=>`<span class="num">${n}</span>`).join("")}</div>
        <div class="muted tiny">${s.note||""}</div>`;
      card.querySelector("[data-idx]").onclick=e=>{
        const i=+e.currentTarget.dataset.idx, s=strategies[i];
        const name=prompt("Nome:",s.name)??s.name;
        const trig=prompt("Gatilho:",s.trigger)??s.trigger;
        const base=prompt("N√∫meros base (v√≠rgula):",s.base.join(","))??s.base.join(",");
        const note=prompt("Obs.:",s.note??"")??s.note??"";
        strategies[i]={name,trigger:trig,base:base.split(",").map(v=>parseInt(v.trim(),10)).filter(Number.isFinite),note};
        localStorage.setItem("sc_strategies",JSON.stringify(strategies)); renderStrategies();
      };
      card.querySelector("[data-del]").onclick=e=>{
        const i=+e.currentTarget.dataset.del;
        if(confirm("Remover esta estrat√©gia?")){ strategies.splice(i,1); localStorage.setItem("sc_strategies",JSON.stringify(strategies)); renderStrategies(); }
      };
      card.querySelector("[data-dup]").onclick=e=>{
        const i=+e.currentTarget.dataset.dup, copy=JSON.parse(JSON.stringify(strategies[i])); copy.name+=" (c√≥pia)";
        strategies.splice(i+1,0,copy); localStorage.setItem("sc_strategies",JSON.stringify(strategies)); renderStrategies();
      };
      box.appendChild(card);
    });
  }

  // Export/Import JSON
  $("btnExportStrats").onclick=()=>{
    const blob=new Blob([JSON.stringify(strategies,null,2)],{type:"application/json;charset=utf-8"});
    const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="strategies.json"; a.click(); URL.revokeObjectURL(a.href);
  };
  $("fileImportStrats").onchange=async e=>{
    const f=e.target.files?.[0]; if(!f) return;
    try{
      const text=await f.text(), arr=JSON.parse(text);
      if(!Array.isArray(arr)) throw new Error("Esperado array");
      strategies=arr.map(s=>({name:String(s.name||"Estrat√©gia"),trigger:String(s.trigger||""),base:(s.base||[]).map(n=>parseInt(n,10)).filter(Number.isFinite),note:String(s.note||"")}));
      localStorage.setItem("sc_strategies",JSON.stringify(strategies)); renderStrategies(); alert("Importado!");
    }catch(err){ alert("Falha ao importar: "+err.message); } finally{ e.target.value=""; }
  };

  // WS
  $("btnConnect").onclick=()=>{
    const url=(wsUrlInput.value||"").trim(); if(!url) return alert("Informe a URL do WebSocket.");
    try{ws&&ws.close()}catch{}; ws=new WebSocket(url);
    ws.onopen=()=>{ addLog("info","WS aberto"); if($("saveUrl").checked) localStorage.setItem("sc_ws_url",url); };
    ws.onmessage=ev=>handleMessage(ev.data);
    ws.onerror=e=>{ addLog("error","WS erro (console)"); console.error(e); };
    ws.onclose=()=>addLog("warn","WS fechado");
  };
  $("btnDisconnect").onclick=()=>{ try{ws&&ws.close()}catch{}; ws=null; };

  function handleMessage(raw){
    addLog("message",raw);
    let data=null; try{data=JSON.parse(raw)}catch{}
    if(data&&data.type==="roulette.winSpots"){ // Evolution
      const res=data?.args?.result?.[0]; updateNumber(res?.number??"--","evolution",data?.args?.description??"",data?.args?.dealer??""); return;
    }
    if(data&&typeof data.winningNumber!=="undefined"){ // Pragmatic
      updateNumber(data.winningNumber,"pragmatic",data.table||data.gameId||"",data.dealer||""); return;
    }
  }
  function updateNumber(n,platform,table,dealer){
    $("lastNumber").textContent=String(n); $("platformName").textContent=platform||"--";
    $("tableName").textContent=table||"--"; $("dealerName").textContent=dealer||"--";
  }

  // Logs + filtro
  function addLog(kind,msg){
    const row=document.createElement("div"); row.className="log-entry";
    const t=new Date().toLocaleTimeString(); row.innerHTML=`<div class="time">[${t}]</div><div class="msg">${escapeHtml(String(msg))}</div>`;
    row.dataset.kind=kind; logBox.appendChild(row); logBox.scrollTop=logBox.scrollHeight; applyFilter();
  }
  function escapeHtml(s){return s.replace(/[&<>\"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]))}
  filterInput.oninput=applyFilter;
  function applyFilter(){
    const q=(filterInput.value||"").toLowerCase();
    qsa(".log-entry",logBox).forEach(r=>{ r.style.display=(!q||r.textContent.toLowerCase().includes(q))?"flex":"none"; });
  }
  $("btnExportCSV").onclick=()=>{
    const rows=qsa(".log-entry",logBox).map(r=>{
      const time=r.querySelector(".time")?.textContent?.replace(/\[|\]/g,"")||"", msg=r.querySelector(".msg")?.textContent||"";
      return `"${time.replace(/"/g,'""')}","${msg.replace(/"/g,'""')}"`;
    });
    const csv="time,message\n"+rows.join("\n"), blob=new Blob([csv],{type:"text/csv;charset=utf-8"});
    const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="sc-logs.csv"; a.click(); URL.revokeObjectURL(a.href);
  };
  $("btnClearLogs").onclick=()=>{ logBox.innerHTML=""; };

  // Timer
  const timerValue=$("timerValue"), beepOnTick=$("beepOnTick"), chkUseWav=$("useWavOnTimer");
  chkUseWav.onchange=e=>{ useWavOnTimer=e.target.checked; if(useWavOnTimer) beepOnTick.checked=false; };
  $("btnTimerStart").onclick=()=>{
    if(timerInterval) return;
    timerInterval=setInterval(()=>{
      timerVal-=0.1;
      if(timerVal<=0){ timerVal=18.0; if(useWavOnTimer) playSound("alerta"); else if(beepOnTick.checked) playBeep(800,0.15); }
      else if(!useWavOnTimer && beepOnTick.checked && Math.abs(timerVal-Math.round(timerVal))<0.05){ playBeep(440,0.05); }
      timerValue.textContent=timerVal.toFixed(1);
    },100);
  };
  $("btnTimerStop").onclick=()=>{ clearInterval(timerInterval); timerInterval=null; };
  $("btnTimerReset").onclick=()=>{ timerVal=18.0; timerValue.textContent=timerVal.toFixed(1); };

  function playBeep(freq=440,dur=0.1){
    try{
      const ctx=new (window.AudioContext||window.webkitAudioContext)(), o=ctx.createOscillator(), g=ctx.createGain();
      o.type="sine"; o.frequency.value=freq; o.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.0001,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.3,ctx.currentTime+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+dur); o.start(); o.stop(ctx.currentTime+dur+0.02);
    }catch(e){console.warn("WebAudio indispon√≠vel",e)}
  }
  function playSound(name){ const a=sounds[name]; if(!a) return; try{ a.currentTime=0; a.play(); }catch(e){ /* sem .wav, ignora */ } }

  // Som: bot√µes
  qsa("button[data-sound]").forEach(btn=>btn.onclick=()=>playSound(btn.getAttribute("data-sound")));

  // Contadores
  const cntGreen=$("cntGreen"), cntRed=$("cntRed");
  let g=+localStorage.getItem("sc_cnt_green")||0, r=+localStorage.getItem("sc_cnt_red")||0;
  function sync(){ cntGreen.textContent=g; cntRed.textContent=r; localStorage.setItem("sc_cnt_green",g); localStorage.setItem("sc_cnt_red",r); }
  sync();
  $("btnIncGreen").onclick=()=>{ g++; sync(); playSound("green"); };
  $("btnIncRed").onclick=()=>{ r++; sync(); playSound("red"); };
  $("btnResetCounters").onclick=()=>{ if(confirm("Zerar contadores?")){ g=0; r=0; sync(); } };

  // Tema
  $("btnToggleTheme").onclick=()=>{
    const isLight=document.body.classList.toggle("light"); document.documentElement.classList.toggle("light",isLight);
    localStorage.setItem("sc_theme",isLight?"light":"dark");
  };
  if(localStorage.getItem("sc_theme")==="light"){ document.body.classList.add("light"); document.documentElement.classList.add("light"); }
})();
</script>
</body>
</html>
